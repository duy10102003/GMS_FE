<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GaragePro - C·∫£nh b√°o t·ªìn kho</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/static/css/staff/staff-dashboard.css">
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <span class="orange">Garage</span><span class="dark">Pro</span>
      </div>
    </div>

    <div class="user-profile">
      <img src="https://ui-avatars.com/api/?name=Tr·∫ßn+Th·ªã+B&background=FF7A00&color=fff" alt="Avatar">
      <div class="user-info">
        <h6>Tr·∫ßn Th·ªã B</h6>
        <small>Nh√¢n vi√™n l·ªÖ t√¢n</small>
      </div>
    </div>

    <ul class="nav-menu">
      <li><a href="/template/staff/dashboard-staff.html" class="nav-link"><i class="fas fa-gauge"></i> Dashboard</a></li>
      <li><a href="/template/staff/payment/payment.html" class="nav-link"><i class="fas fa-credit-card"></i> Thanh to√°n</a></li>
      <li><a href="/template/staff/inventory/inventory-alert.html" class="nav-link active"><i class="fas fa-exclamation-triangle"></i> C·∫£nh b√°o kho</a></li>
    </ul>

    <button class="logout-btn" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
    </button>
  </aside>

  <!-- Header -->
  <header class="main-header d-flex align-items-center justify-content-between">
    <h1 class="page-title">C·∫£nh b√°o t·ªìn kho üö®</h1>
    <div class="dropdown position-relative">
      <button class="notification-btn" id="notifDropdown" data-bs-toggle="dropdown">
        <i class="fas fa-bell"></i>
        <span class="notification-badge">2</span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="d-flex justify-content-end align-items-center mb-3">
      <nav class="breadcrumb mb-0">
        <span><a href="#" class="text-primary text-decoration-none">Staff</a></span>
        <span class="mx-2 text-muted">/</span>
        <span class="text-muted">C·∫£nh b√°o t·ªìn kho</span>
      </nav>
    </div>

    <!-- Alert Card -->
    <div class="content-card fade-in">
      <div class="content-card-header d-flex justify-content-between align-items-center flex-wrap gap-3">
        <h5><i class="fas fa-boxes-stacked me-2"></i>Danh s√°ch c·∫£nh b√°o t·ªìn kho</h5>

        <div class="filter-tabs">
          <button class="btn btn-outline-secondary active" onclick="filterAlerts('all', event)">
            <i class="fas fa-list me-1"></i> T·∫•t c·∫£
          </button>
          <button class="btn btn-outline-warning" onclick="filterAlerts('low', event)">
            <i class="fas fa-hourglass-half me-1"></i> S·∫Øp h·∫øt
          </button>
          <button class="btn btn-outline-danger" onclick="filterAlerts('out', event)">
            <i class="fas fa-times-circle me-1"></i> H·∫øt h√†ng
          </button>
        </div>
      </div>

      <!-- Table -->
      <div style="overflow-x: auto;">
        <table class="custom-table">
          <thead>
            <tr>
              <th>M√£ ph·ª• t√πng</th>
              <th>T√™n ph·ª• t√πng</th>
              <th>T·ªìn kho</th>
              <th>Ng∆∞·ª°ng c·∫£nh b√°o</th>
              <th>Tr·∫°ng th√°i</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="inventoryTableBody"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination" id="pagination"></ul>
      </nav>
    </div>
  </main>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Modal: X√°c nh·∫≠n b√°o qu·∫£n l√Ω -->
  <div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-paper-plane me-2 text-primary"></i>X√°c nh·∫≠n g·ª≠i c·∫£nh b√°o</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën g·ª≠i c·∫£nh b√°o ph·ª• t√πng <strong id="confirmItemName"></strong> ƒë·∫øn Qu·∫£n l√Ω kho kh√¥ng?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
          <button class="btn btn-primary" id="confirmSendBtn">
            <i class="fas fa-check me-1"></i>X√°c nh·∫≠n
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===========================
    // D·ªÆ LI·ªÜU GI·∫¢ L·∫¨P
    // ===========================
    let stockAlerts = [
      { id: 'PT001', name: 'D·∫ßu ƒë·ªông c∆° 5W-30', quantity: 3, threshold: 5, status: 'low', reported: false },
      { id: 'PT002', name: 'Bugi NGK', quantity: 0, threshold: 10, status: 'out', reported: false },
      { id: 'PT003', name: 'M√° phanh tr∆∞·ªõc', quantity: 12, threshold: 5, status: 'ok', reported: false },
      { id: 'PT004', name: 'L·ªçc gi√≥ cabin', quantity: 2, threshold: 5, status: 'low', reported: false },
      { id: 'PT005', name: 'D√¢y curoa m√°y ph√°t', quantity: 0, threshold: 3, status: 'out', reported: false }
    ];

    let currentFilter = 'all';
    let currentPage = 1;
    const limit = 5;
    let selectedAlert = null;
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));

    // ===========================
    // HI·ªÇN TH·ªä D·ªÆ LI·ªÜU
    // ===========================
    function renderTable() {
      const tbody = document.getElementById('inventoryTableBody');
      const filtered = currentFilter === 'all' ? stockAlerts : stockAlerts.filter(a => a.status === currentFilter);
      const start = (currentPage - 1) * limit;
      const visible = filtered.slice(start, start + limit);

      tbody.innerHTML = visible.map(item => `
        <tr>
          <td><strong style="color: var(--primary)">#${item.id}</strong></td>
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${item.threshold}</td>
          <td>${renderStatus(item.status)}</td>
          <td>${renderAction(item)}</td>
        </tr>
      `).join('');

      renderPagination(filtered.length);
    }

    function renderStatus(status) {
      const map = {
        'ok': { class: 'status-badge paid', text: 'C√≤n ƒë·ªß' },
        'low': { class: 'status-badge assigned', text: 'S·∫Øp h·∫øt' },
        'out': { class: 'status-badge cancelled', text: 'H·∫øt h√†ng' }
      };
      return `<span class="${map[status].class}">${map[status].text}</span>`;
    }

    function renderAction(item) {
      if (item.status === 'ok') {
        return `<button class="action-btn" disabled><i class="fas fa-check-circle"></i> ·ªîn ƒë·ªãnh</button>`;
      }

      if (item.reported) {
        return `<button class="action-btn" disabled><i class="fas fa-check"></i> ƒê√£ b√°o qu·∫£n l√Ω</button>`;
      }

      return `<button class="action-btn" style="background:#e76f00;border:none;" onclick="openConfirmModal('${item.id}')">
                <i class="fas fa-paper-plane me-1"></i>B√°o qu·∫£n l√Ω
              </button>`;
    }

    function renderPagination(total) {
      const totalPages = Math.ceil(total / limit);
      const pagination = document.getElementById('pagination');
      if (totalPages <= 1) return pagination.innerHTML = '';

      pagination.innerHTML = Array.from({ length: totalPages }, (_, i) => `
        <li class="page-item ${i + 1 === currentPage ? 'active' : ''}">
          <button class="page-link" onclick="gotoPage(${i + 1})">${i + 1}</button>
        </li>`).join('');
    }

    function gotoPage(page) {
      currentPage = page;
      renderTable();
    }

    // ===========================
    // H√ÄNH ƒê·ªòNG
    // ===========================
    function openConfirmModal(id) {
      selectedAlert = stockAlerts.find(a => a.id === id);
      document.getElementById('confirmItemName').textContent = selectedAlert.name;
      modal.show();
    }

    document.getElementById('confirmSendBtn').addEventListener('click', () => {
      if (!selectedAlert) return;
      selectedAlert.reported = true;
      modal.hide();
      renderTable();
      showToast('success', 'ƒê√£ g·ª≠i c·∫£nh b√°o!', `Ph·ª• t√πng <strong>${selectedAlert.name}</strong> ƒë√£ ƒë∆∞·ª£c b√°o cho Qu·∫£n l√Ω kho ‚úÖ`);
    });

    function filterAlerts(filter, e) {
      document.querySelectorAll('.filter-tabs button').forEach(btn => btn.classList.remove('active'));
      e.currentTarget.classList.add('active');
      currentFilter = filter;
      currentPage = 1;
      renderTable();
    }

    // ===========================
    // GI·∫¢ L·∫¨P C·∫¨P NH·∫¨T KHO
    // ===========================
    setInterval(() => {
      stockAlerts.forEach(item => {
        if (item.reported && item.status !== 'ok') {
          // Gi·∫£ l·∫≠p: Manager ƒë√£ nh·∫≠p kho
          if (Math.random() > 0.6) {
            item.quantity += item.threshold;
            item.status = 'ok';
            item.reported = false;
            showToast('success', 'Kho ƒë√£ c·∫≠p nh·∫≠t!', `Ph·ª• t√πng <strong>${item.name}</strong> ƒë√£ ƒë·ªß h√†ng tr·ªü l·∫°i üß∞`);
          }
        }
      });
      renderTable();
    }, 10000);

    // ===========================
    // TOAST TH√îNG B√ÅO
    // ===========================
    function showToast(type, title, message) {
      const container = document.getElementById('toastContainer');
      const id = Date.now();
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.id = `toast-${id}`;
      toast.innerHTML = `
        <div class="toast-icon"><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i></div>
        <div class="toast-content">
          <p class="toast-title">${title}</p>
          <p class="toast-message">${message}</p>
        </div>`;
      container.appendChild(toast);
      setTimeout(() => { toast.style.animation = 'slideIn 0.4s reverse'; setTimeout(() => toast.remove(), 400); }, 3000);
    }

    // ===========================
    // LOGOUT
    // ===========================
    function logout() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
        document.body.style.opacity = '0';
        setTimeout(() => {
          alert('ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!');
          window.location.href = 'login.html';
        }, 500);
      }
    }

    // ===========================
    // KH·ªûI T·∫†O
    // ===========================
    document.addEventListener('DOMContentLoaded', renderTable);
  </script>
</body>
</html>
